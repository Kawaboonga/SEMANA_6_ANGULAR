<!-- ===========================================================================
     PRODUCT CARD COMPONENT (HTML)
     ---------------------------------------------------------------------------
     - Card reutilizable para productos del marketplace.
     - Incluye:
         ✓ Imagen + badges (condición, nuevo ingreso, descuento)
         ✓ Título clicable
         ✓ Datos breves: marca, modelo, año
         ✓ Precio + precio anterior
         ✓ Resumen automático (getSummary)
         ✓ Botones de administración (Editar / Eliminar) opcionales
     =========================================================================== -->

<div class="card hover-lift h-100">

  <!-- ============================================================
       SECCIÓN: IMAGEN PRINCIPAL + BADGES SUPERIORES
       ============================================================ -->
  <div class="position-relative">

    <!-- Imagen del producto (fallback por URL pública) -->
    <img
      [src]="imageSrc"
      (error)="onImgError($event)"
      [alt]="product.name"
      class="card-img-top img-fluid"
    />

    <!-- Badges informativos -->
    <div class="position-absolute top-0 start-0 m-2 d-flex flex-wrap gap-1">

      <span *ngIf="product.condition === 'usado'" class="badge bg-warning">
        Usado
      </span>

      <span *ngIf="product.condition === 'nuevo'" class="badge bg-success">
        Nuevo
      </span>

      <span *ngIf="hasDiscount" class="badge bg-danger">
        -{{ discountPercent }}%
      </span>

      <span *ngIf="product.isNew" class="badge bg-info">
        Nuevo ingreso
      </span>

      <span *ngIf="product.isPreSale" class="badge bg-primary">
        Preventa
      </span>
    </div>
  </div>

  <!-- ============================================================
       SECCIÓN: CUERPO DE LA CARD
       ============================================================ -->
  <div class="card-body d-flex flex-column">

    <!-- Título del producto -->
    <h3 class="h6 mb-1">
      <a
        [routerLink]="['/productos', product.slug]"
        class="text-decoration-none text-dark"
      >
        {{ product.name }}
      </a>
    </h3>

    <hr />

    <!-- Marca / modelo / año -->
    <p class="text-muted small mb-1">
      <span *ngIf="product.brand">{{ product.brand }}</span>
      <span *ngIf="product.model"> · {{ product.model }}</span>
      <span *ngIf="product.year"> · {{ product.year }}</span>
    </p>

    <!-- Resumen -->
    <p class="text-body-secondary small flex-grow-1 mb-2">
      {{ getSummary(product) }}
    </p>

  </div>

  <!-- ============================================================
       BOTONES ADMIN (solo si canEdit = true)
       ============================================================ -->
  <div *ngIf="canEdit" class="px-3 pb-3">
    <div class="d-flex gap-2">

      <button
        type="button"
        class="btn btn-sm btn-outline-secondary"
        (click)="onEditClick($event)"
      >
        <i class="bi bi-pencil-square me-1"></i>
        Editar
      </button>

      <button
        type="button"
        class="btn btn-sm btn-outline-danger"
        (click)="onDeleteClick($event)"
      >
        <i class="bi bi-trash me-1"></i>
        Eliminar
      </button>

    </div>
  </div>

  <!-- ============================================================
       SECCIÓN: FOOTER (precio + ubicación)
       ============================================================ -->
  <div class="card-footer">
    <div class="d-flex justify-content-between align-items-center py-2 gap-2">

      <span class="fw-bold">
        {{ product.price
          | currency:(product.currency || 'CLP'):'symbol-narrow':'1.0-0' }}
      </span>

      <small
        *ngIf="product.previousPrice"
        class="text-muted text-decoration-line-through ms-1"
      >
        {{ product.previousPrice
          | currency:(product.currency || 'CLP'):'symbol-narrow':'1.0-0' }}
      </small>

      <small *ngIf="product.location" class="text-muted">
        <i class="bi bi-geo-alt me-1"></i>{{ product.location }}
      </small>

      <!-- CTA: Ver detalle del producto (igual que la navegación por título) -->
      <a
        class="btn btn-sm btn-outline-primary ms-auto"
        [routerLink]="['/productos', product.slug]"
      >
        Ver detalles
      </a>

    </div>
  </div>

</div>
